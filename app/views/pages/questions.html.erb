<style>
.hide-overflow {
  white-space: nowrap;
  overflow: hidden;
  text-overflow:ellipsis;
  width: 40em;
}
</style>

<div class='pusher' ng-controller='QuestionsController'>
  <div class='ui container grid'>
    <div class='one column row'>
    </div>
    <div class="one column row">
      <div class="column">
        <h1>All Questions</h1>
      </div>
    </div>
    <div class='three column row'>
      <div class="left floated five wide column">
        <div class="ui dropdown labeled icon fluid button" id="search-option-dropdown">
          <i class="filter icon"></i>
          <span class="text">
            Filter
          </span>
          <div class="menu">
            <div class="header">
              <i class="asterisk"></i>
              Features
            </div>
            <div class="item"
              ng-if="is_showing_enabled"
              ng-click="show_disabled()">
              Show disabled questions
            </div>
            <div class="item"
              ng-if="!is_showing_enabled"
              ng-click="show_enabled()">
              Show enabled questions
            </div>
            <div class="ui icon input" ng-class="{loading: searching}">
              <i class="search icon"></i>
              <input type="text" placeholder="Search Keywords..."
              ng-model="keyword"
              ng-change="prepare_search()">
            </div>
            <div class="divider"></div>
            <div class="header">
              <i class="tag icon"></i>
              Topics
            </div>
            <div class="scrolling menu">
              <div class="item" ng-click="select_topic()">
                All
              </div>
              <div class="item"
                ng-repeat="topic in topics"
                ng-click="select_topic(topic.token)">
                {{topic.name}}
              </div>
            </div>
            <div class="divider"></div>
            <div class="header">
              Question Types
            </div>
            <div class="scrolling menu">
              <div class="item" ng-click="select_question_type()">
                All
              </div>
              <div class="item"
                ng-repeat="(type, name) in question_types"
                ng-click="select_question_type(type)">
                {{name}}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="right floated five wide column">
        <a href='question'>
          <button type="button" class="ui labeled icon green button">
            <i class="plus icon"></i>
            Add New Question
          </button>
        </a>
      </div>
    </div>
    <div class='one column centered row'>
      <div class='column'>
        <table class="ui large table">
          <colgroup>
            <col span="1">
            <col span="1">
            <col span="1">
            <col span="1">
            <col span="2">
          </colgroup>
          <thead>
            <tr>
              <th>
              </th>
              <th colspan="4">
                <div class="five wide field">
                  <div class="ui fluid icon input">
                    <input type="text"
                      placeholder="Filter by topic, content in this table..."
                      ng-model='searchText'>
                    <i class="search icon"></i>
                  </div>
                </div>
              </th>
              <th>
              </th>
            </tr>
            <tr>
              <th>Topic</th>
              <th>Difficulty</th>
              <th>Type</th>
              <th>Question</th>
              <th colspan="2"></th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="question in questions | filter:searchText">
              <td>{{question.topic}}</td>
              <td>{{question.difficulty}}</td>
              <td>{{question.type}}</td>
              <td>
                <div class="hide-overflow" ng-bind-html="question.description">
                </div>
                <div class="ui popup" ng-bind-html="question.description">
                </div>
              </td>
              <td>
                <a class="ui button"
                  ng-href="/question/{{question.id}}/edit">
                  Edit
                </a>
              </td>
              <td ng-switch on='question.enabled'>
                <div ng-switch-when='true'>
                  <button class="ui red button" ng-click='disable(question, $index)'>
                    Disable
                  </button>
                </div>
                <div ng-switch-when='false'>
                  <button class="ui green button" ng-click='enable(question, $index)'>
                    Enable
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<script>
$(function () {
  function debug() {
    debugger;
    return true;
  }
  $('#search-option-dropdown').dropdown();
  var observer = new MutationObserver(mutations =>
    mutations.forEach(record =>
      record.type === 'childList' &&
      Array.prototype.forEach.call(record.addedNodes, node =>
        $('.ui.popup', node).prev().popup())));
  observer.observe(document.body, {childList: true, subtree: true});
});
</script>
